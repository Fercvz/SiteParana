<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interativo do Paran√°</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js para gr√°ficos eleitorais -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- SheetJS para Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Top Stats Bar (Admin Only) -->
        <div id="campaign-stats" class="campaign-stats hidden">
            <div class="stat-item">
                <span class="stat-label">Total Votos:</span>
                <span id="global-votes" class="stat-value">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Investimento Total:</span>
                <span id="global-money" class="stat-value">R$ 0,00</span>
            </div>
            <div class="header-divider"></div>
            <div class="admin-actions">
                <button id="btn-summary" class="btn-icon" title="Tabela Resumo">üìä Ver Tabela</button>
                <div class="import-wrapper">
                    <input type="file" id="file-import" accept=".xlsx,.xls" hidden />
                    <button id="btn-import" class="btn-icon" title="Importar Excel">üìÇ Importar Excel</button>
                </div>
            </div>
        </div>

        <!-- Login Button Removed (Moved to Header) -->

        <!-- Professional Header -->
        <header class="site-header">
            <div class="brand-container">
                <h1>Mapa Interativo do Paran√°</h1>
                <p>Explore detalhes demogr√°ficos, econ√¥micos e pol√≠ticos dos 399 munic√≠pios.</p>
            </div>

            <div class="header-tools">
                <div class="search-container">
                    <input type="text" id="city-search" placeholder="Buscar cidade..." list="cities-list">
                    <datalist id="cities-list"></datalist>
                    <button id="search-btn" aria-label="Buscar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                </div>
                <button id="login-btn" class="login-btn">Entrar</button>
                <button id="theme-toggle" aria-label="Alternar Tema">üåô</button>
            </div>
        </header>

        <!-- Main Content Area (Layout: Filters | Map | Details) -->
        <div class="main-content">

            <!-- Left Sidebar for Filters & Stats -->
            <aside class="left-sidebar">
                <div class="sidebar-section state-info">
                    <h3>Estado do Paran√°</h3>
                    <div class="info-card">
                        <div class="info-row">
                            <span>Cidades:</span>
                            <strong>399</strong>
                        </div>
                        <div class="info-row">
                            <span>Habitantes:</span>
                            <strong>~11.8 Milh√µes</strong>
                        </div>
                        <div class="info-row">
                            <span>Governador:</span>
                            <strong>Ratinho J√∫nior (PSD)</strong>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section visualization">
                    <h3>Visualiza√ß√£o</h3>
                    <div class="filter-group">
                        <label for="vis-mode">Modo de Mapa</label>
                        <select id="vis-mode">
                            <option value="none">Padr√£o</option>
                            <option value="party">Partidos Pol√≠ticos</option>
                            <option value="heatmap-pop"> Habitantes (Mapa de Calor) </option>
                            <option value="heatmap-pib"> PIB per capita (Mapa de Calor) </option>
                        </select>
                    </div>

                    <div id="map-legend" class="legend-container hidden">
                        <!-- Legend items injected by JS -->
                    </div>
                </div>

                <div class="sidebar-section filters">
                    <h3>Filtrar Cidades</h3>

                    <div class="filter-group">
                        <label for="filter-party">Partido (Prefeito)</label>
                        <select id="filter-party">
                            <option value="all">Todos</option>
                            <option value="PSD">PSD</option>
                            <option value="PL">PL</option>
                            <option value="PP">PP</option>
                            <option value="Uni√£o Brasil">Uni√£o Brasil</option>
                            <option value="Republicanos">Republicanos</option>
                            <option value="MDB">MDB</option>
                            <option value="PT">PT</option>
                            <option value="PDT">PDT</option>
                            <option value="Podemos">Podemos</option>
                            <!-- Add other parties dynamically if needed -->
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Habitantes (m√≠nimo: <span id="val-pop">0</span>)</label>
                        <input type="range" id="filter-pop" min="0" max="2000000" step="10000" value="0">
                    </div>

                    <div class="filter-group">
                        <label>√Årea (km¬≤) (m√≠nimo: <span id="val-area">0</span>)</label>
                        <input type="range" id="filter-area" min="0" max="4000" step="100" value="0">
                    </div>

                    <button id="reset-filters">Limpar Filtros</button>
                    <p class="filter-note">Cidades destacadas: <strong id="highlight-count">399</strong></p>
                </div>
            </aside>

            <main class="map-container" id="map-container">
                <div id="map-svg-layer"
                    style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                    <div id="loading">Carregando mapa...</div>
                </div>
                <!-- SVG will be injected here -->

                <!-- Data Source Note -->
                <div class="data-source-note">
                    Informa√ß√µes do site do IBGE e dados eleitorais do STF (dados de 2024)
                </div>

                <div class="zoom-controls">
                    <button id="zoom-in" aria-label="Zoom In">+</button>
                    <button id="zoom-out" aria-label="Zoom Out">-</button>
                    <button id="zoom-reset" aria-label="Reset Zoom">‚ü≤</button>
                </div>
            </main>

            <!-- Tooltip -->
            <div id="tooltip" class="tooltip hidden"></div>

            <!-- Details Sidebar/Modal (Right) -->
            <aside id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <h2 id="city-name">Selecione uma cidade</h2>
                    <button id="close-sidebar" aria-label="Fechar">√ó</button>
                    <div id="save-msg"></div>
                </div>

                <!-- Sistema de Abas -->
                <div class="sidebar-tabs">
                    <button class="tab-btn hidden" id="tab-btn-campaign" data-tab="campaign">Dados Campanha</button>
                    <button class="tab-btn hidden" id="tab-btn-insights" data-tab="insights">Insights</button>
                    <button class="tab-btn active" data-tab="info">Informa√ß√µes</button>
                    <button class="tab-btn" data-tab="eleitorado">Eleitorado</button>
                </div>

                <div class="tab-content" id="tab-campaign">
                    <div id="campaign-form" class="campaign-form">
                        <h3>üó≥Ô∏è Dados de Campanha</h3>
                        <div class="input-group">
                            <label>Votos Recebidos:</label>
                            <input type="number" id="input-votes" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>Investimento (R$):</label>
                            <input type="number" id="input-money" placeholder="0.00" step="0.01">
                        </div>
                        <button id="btn-save-campaign" class="btn-primary">Salvar Dados</button>
                    </div>
                </div>

                <!-- Aba: Insights (Admin) -->
                <div class="tab-content" id="tab-insights">
                    <div class="insights-list">
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Votos Recebidos:</span>
                            </div>
                            <span class="value" id="ins-votes">-</span>
                        </div>
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Investimento (R$):</span>
                            </div>
                            <span class="value" id="ins-money">-</span>
                        </div>
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Votos Convertidos (%):</span>
                                <small class="desc">Votos recebidos / Total de eleitores da cidade</small>
                            </div>
                            <span class="value" id="ins-conversion">-</span>
                        </div>
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Investimento por Voto:</span>
                                <small class="desc">Investimento / Votos recebidos</small>
                            </div>
                            <span class="value" id="ins-cost-vote">-</span>
                        </div>
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Investimento por Habitante:</span>
                                <small class="desc">Investimento / Popula√ß√£o total da cidade</small>
                            </div>
                            <span class="value" id="ins-cost-pop">-</span>
                        </div>
                        <div class="insight-item">
                            <div class="label-group">
                                <span class="label">Participa√ß√£o (%):</span>
                                <small class="desc">Votos da cidade / Total de votos da campanha</small>
                            </div>
                            <span class="value" id="ins-share">-</span>
                        </div>
                    </div>
                </div>

                <!-- Aba: Informa√ß√µes -->
                <div class="tab-content active" id="tab-info">
                    <div class="sidebar-content" id="sidebar-details">
                        <p id="city-desc" class="description">Clique no mapa para ver detalhes.</p>

                        <!-- Campos de informa√ß√£o conforme especifica√ß√£o -->
                        <div class="details-list">
                            <div class="detail-row">
                                <strong>Nome da cidade:</strong> <span id="stat-nome">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>Gent√≠lico:</strong> <span id="stat-gentilico">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>Prefeito:</strong> <span id="stat-prefeito">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>Partido pol√≠tico:</strong> <span id="stat-partido">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>Habitantes:</strong> <span id="stat-habitantes">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>√Årea:</strong> <span id="stat-area">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>Densidade demogr√°fica:</strong> <span id="stat-densidade">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>IDHM:</strong> <span id="stat-idhm">-</span>
                            </div>
                            <div class="detail-row">
                                <strong>PIB per capita:</strong> <span id="stat-pib">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba: Eleitorado -->
                <div class="tab-content" id="tab-eleitorado">
                    <div class="eleitorado-content">
                        <!-- Total de Eleitores -->
                        <div class="eleitorado-header">
                            <div class="total-eleitores">
                                <span class="total-label">Total de Eleitores</span>
                                <span class="total-value" id="total-eleitores">-</span>
                            </div>
                        </div>

                        <!-- Gr√°ficos -->
                        <div class="chart-section">
                            <h4>üë• G√™nero</h4>
                            <div class="chart-container-small">
                                <canvas id="chart-genero"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h4>üìä Faixa Et√°ria</h4>
                            <div class="chart-container">
                                <canvas id="chart-idade"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h4>üéì Grau de Instru√ß√£o</h4>
                            <div class="chart-container">
                                <canvas id="chart-instrucao"></canvas>
                            </div>
                        </div>

                        <div class="chart-section">
                            <h4>üíç Estado Civil</h4>
                            <div class="chart-container-small">
                                <canvas id="chart-civil"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
            </aside>
        </div>

        <!-- Chat Widget -->
        <div class="chat-widget-container">
            <button class="chat-toggle-btn" id="chat-toggle" aria-label="Abrir Chat IA">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
            </button>

            <div class="chat-window" id="chat-window">
                <div class="chat-header">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2a10 10 0 1 0 10 10H12V2z"></path>
                            <path d="M12 2a10 10 0 0 1 10 10h-10V2z"></path>
                            <path d="M12 12l9.5 5.5"></path>
                        </svg>
                        Paran√° AI Assistant
                    </h3>
                    <button class="chat-close" id="chat-close">√ó</button>
                </div>
                <div class="chat-messages" id="chat-messages">
                    <div class="message bot">
                        Ol√°! Sou sua intelig√™ncia artificial geogr√°fica. Pergunte sobre prefeitos, economia ou √∫ltimas
                        not√≠cias de qualquer cidade!
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Digite sua pergunta...">
                    <button class="chat-send" id="chat-send">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal hidden">
        <div class="modal-content">
            <span id="close-login" class="close-modal">&times;</span>
            <h2>Acesso Restrito</h2>
            <form id="login-form">
                <div class="input-group">
                    <label>Usu√°rio:</label>
                    <input type="text" id="login-user" autocomplete="username">
                </div>
                <div class="input-group">
                    <label>Senha:</label>
                    <input type="password" id="login-pass" autocomplete="current-password">
                </div>
                <!-- type="submit" enables Enter key automatically -->
                <button type="submit" id="btn-perform-login" class="btn-primary full-width">Entrar</button>
            </form>
            <p id="login-msg" class="error-msg"></p>
        </div>
    </div>

    <!-- Tabela Resumo Modal -->
    <div id="summary-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>Resumo Geral da Campanha</h3>
                <button id="close-summary">√ó</button>
            </div>
            <div class="modal-body">
                <div class="table-actions">
                    <button id="btn-export-excel" class="btn-primary">Exportar Excel</button>
                </div>
                <div class="table-container">
                    <table id="summary-table">
                        <thead>
                            <tr>
                                <th>Cidade</th>
                                <th>Votos</th>
                                <th>Invest. (R$)</th>
                                <th>Conv. (%)</th>
                                <th>R$/Voto</th>
                                <th>R$/Pop</th>
                                <th>Part. (%)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Instructions Modal -->
    <div id="import-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Instru√ß√µes de Importa√ß√£o</h3>
                <button id="close-import">√ó</button>
            </div>
            <div class="modal-body">
                <p class="modal-text">Para importar os dados corretamente, sua planilha Excel deve seguir
                    <strong>estritamente</strong> o modelo abaixo (nomes das colunas e cidades):
                </p>

                <div class="example-table-container">
                    <table class="example-table">
                        <thead>
                            <tr>
                                <th>Cidade</th>
                                <th>Votos</th>
                                <th>Investimento</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Curitiba</td>
                                <td>15000</td>
                                <td>500000</td>
                            </tr>
                            <tr>
                                <td>Londrina</td>
                                <td>8000</td>
                                <td>250000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <ul class="modal-list">
                    <li>As colunas devem se chamar <strong>"Cidade"</strong>, <strong>"Votos"</strong> e
                        <strong>"Investimento"</strong>.
                    </li>
                    <li>O nome das cidades deve coincidir exatamente com o cadastro do sistema.</li>
                    <li>Cidades com nomes incorretos ou n√£o cadastrados ser√£o ignoradas.</li>
                </ul>

                <div class="modal-footer-center">
                    <button id="btn-confirm-import" class="btn-primary">ENTENDI</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>